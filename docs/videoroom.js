!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.videoroom=t():e.videoroom=t()}(self,()=>(()=>{"use strict";var e={35(e,t,n){n.r(t),n.d(t,{default:()=>r}),e=n.hmd(e);var r=function(t){if("function"==typeof define&&n.amdO)define(t);else if(e.exports)e.exports=t();else if("object"==typeof window)return t()}(function(){t.sessions=new Map,t.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){let e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),e>=26&&e<=n||t.extension.isInstalled()}return!0};var e={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){let t=window.setTimeout(function(){let t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)},1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){let e={};this.cache=e,window.addEventListener("message",function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){let n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){let e=new Error("NavigatorUserMediaError");e.name="You cancelled the request for permission, giving up...",n(e)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&window.clearTimeout(t.data.id)})}};function t(e){if((e=e||{}).success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:t.noop,!t.initDone)return e.error("Library not initialized"),{};if(!t.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(t.log("Library initialized: "+t.initDone),!e.server)return e.error("Invalid server url"),{};let n=!1,r=null,o={},i=null,s=null,a=0,c=e.server;t.isArray(c)?(t.log("Multiple servers provided ("+c.length+"), will use the first that works"),c=null,s=e.server,t.debug(s)):0===c.indexOf("ws")?(n=!0,t.log("Using WebSockets to contact Janus: "+c)):(n=!1,t.log("Using REST API to contact Janus: "+c));let d=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],u=e.iceTransportPolicy,l=e.bundlePolicy,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);let f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);let m=null;void 0!==e.token&&null!==e.token&&(m=e.token);let h=null;void 0!==e.apisecret&&null!==e.apisecret&&(h=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);let g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);let v=6e4;function y(e){let t={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(v=e.longPollTimeout),isNaN(v)&&(v=6e4);let b=!1,C=null,S=new Map,w=this,T=0,k=new Map;function R(){if(null==C)return;if(t.debug("Long poll..."),!b)return void t.warn("Is the server down? (connected=false)");let n=c+"/"+C+"?rid="+(new Date).getTime();f&&(n=n+"&maxev="+f),m&&(n=n+"&token="+encodeURIComponent(m)),h&&(n=n+"&apisecret="+encodeURIComponent(h)),t.httpAPICall(n,{verb:"GET",withCredentials:p,success:P,timeout:v,error:function(n,r){if(t.error(n+":",r),T++,T>3)return b=!1,void e.error("Lost connection to the server (is it down?)");R()}})}function P(e,o){if(T=0,n||null==C||!0===o||R(),n||!t.isArray(e))if("keepalive"!==e.janus){if("server_info"===e.janus){t.debug("Got info on the Janus instance"),t.debug(e);const n=e.transaction;if(n){const t=k.get(n);t&&t(e),k.delete(n)}return}if("ack"===e.janus){t.debug("Got an ack on session "+C),t.debug(e);const n=e.transaction;if(n){const t=k.get(n);t&&t(e),k.delete(n)}return}if("success"===e.janus){t.debug("Got a success on session "+C),t.debug(e);const n=e.transaction;if(n){const t=k.get(n);t&&t(e),k.delete(n)}return}if("trickle"===e.janus){const n=e.sender;if(!n)return void t.warn("Missing sender...");const r=S.get(n);if(!r)return void t.debug("This handle is not attached to this session");let o=e.candidate;t.debug("Got a trickled candidate on session "+C),t.debug(o);let i=r.webrtcStuff;i.pc&&i.remoteSdp?(t.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(t.endOfCandidates)):(t.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(o),t.debug(i.candidates))}else{if("webrtcup"===e.janus){t.debug("Got a webrtcup event on session "+C),t.debug(e);const n=e.sender;if(!n)return void t.warn("Missing sender...");const r=S.get(n);return r?void r.webrtcState(!0):void t.debug("This handle is not attached to this session")}if("hangup"===e.janus){t.debug("Got a hangup event on session "+C),t.debug(e);const n=e.sender;if(!n)return void t.warn("Missing sender...");const r=S.get(n);if(!r)return void t.debug("This handle is not attached to this session");r.webrtcState(!1,e.reason),r.hangup()}else if("detached"===e.janus){t.debug("Got a detached event on session "+C),t.debug(e);const n=e.sender;if(!n)return void t.warn("Missing sender...");const r=S.get(n);if(!r)return;r.ondetached(),r.detach()}else if("media"===e.janus){t.debug("Got a media event on session "+C),t.debug(e);const n=e.sender;if(!n)return void t.warn("Missing sender...");const r=S.get(n);if(!r)return void t.debug("This handle is not attached to this session");r.mediaState(e.type,e.receiving,e.mid)}else if("slowlink"===e.janus){t.debug("Got a slowlink event on session "+C),t.debug(e);const n=e.sender;if(!n)return void t.warn("Missing sender...");const r=S.get(n);if(!r)return void t.debug("This handle is not attached to this session");r.slowLink(e.uplink,e.lost,e.mid)}else{if("error"===e.janus){t.error("Ooops: "+e.error.code+" "+e.error.reason),t.debug(e);let n=e.transaction;if(n){let t=k.get(n);t&&t(e),k.delete(n)}return}if("event"===e.janus){t.debug("Got a plugin event on session "+C),t.debug(e);const n=e.sender;if(!n)return void t.warn("Missing sender...");let r=e.plugindata;if(!r)return void t.warn("Missing plugindata...");t.debug("  -- Event is coming from "+n+" ("+r.plugin+")");let o=r.data;t.debug(o);const i=S.get(n);if(!i)return void t.warn("This handle is not attached to this session");let s=e.jsep;s&&(t.debug("Handling SDP as well..."),t.debug(s));let a=i.onmessage;a?(t.debug("Notifying application..."),a(o,s)):t.debug("No provided notification callback")}else{if("timeout"===e.janus)return t.error("Timeout on session "+C),t.debug(e),void(n&&r.close(3504,"Gateway timeout"));t.warn("Unknown message/event  '"+e.janus+"' on session "+C),t.debug(e)}}}}else t.vdebug("Got a keepalive on session "+C);else for(let t=0;t<e.length;t++)P(e[t],!0)}function E(){if(!c||!n||!b)return;i=setTimeout(E,g);let e={janus:"keepalive",session_id:C,transaction:t.randomString(12)};m&&(e.token=m),h&&(e.apisecret=h),r.send(JSON.stringify(e))}function x(d){let u=t.randomString(12),l={janus:"create",transaction:u};if(d.reconnect&&(b=!1,l.janus="claim",l.session_id=C,r&&(r.onopen=null,r.onerror=null,r.onclose=null,i&&(clearTimeout(i),i=null))),m&&(l.token=m),h&&(l.apisecret=h),!c&&t.isArray(s)&&(c=s[a],0===c.indexOf("ws")?(n=!0,t.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+c+")")):(n=!1,t.log("Server #"+(a+1)+": trying REST API to contact Janus ("+c+")"))),n){r=t.newWebSocket(c,"janus-protocol"),o={error:function(){if(t.error("Error connecting to the Janus WebSockets server... "+c),t.isArray(s)&&!d.reconnect)return a++,a===s.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(c=null,void setTimeout(function(){x(d)},200));d.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){k.set(u,function(e){if(t.debug(e),"success"!==e.janus)return t.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);i=setTimeout(E,g),b=!0,C=e.session_id?e.session_id:e.data.id,d.reconnect?t.log("Claimed session: "+C):t.log("Created session: "+C),t.sessions.set(C,w),d.success()}),r.send(JSON.stringify(l))},message:function(e){P(JSON.parse(e.data))},close:function(){c&&b&&(b=!1,e.error("Lost connection to the server (is it down?)"))}};for(let e in o)r.addEventListener(e,o[e])}else t.httpAPICall(c,{verb:"POST",withCredentials:p,body:l,success:function(e){if(t.debug(e),"success"!==e.janus)return t.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);b=!0,C=e.session_id?e.session_id:e.data.id,d.reconnect?t.log("Claimed session: "+C):t.log("Created session: "+C),t.sessions.set(C,w),R(),d.success()},error:function(e,n){if(t.error(e+":",n),t.isArray(s)&&!d.reconnect)return a++,a===s.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(c=null,void setTimeout(function(){x(d)},200));""===n?d.error(e+": Is the server down?"):n&&n.error?d.error(e+": "+n.error.message):d.error(e+": "+n)}})}function O(e,o){if((o=o||{}).success="function"==typeof o.success?o.success:t.noop,o.error="function"==typeof o.error?o.error:t.noop,!b)return t.warn("Is the server down? (connected=false)"),void o.error("Is the server down? (connected=false)");let i=S.get(e);if(!i||!i.webrtcStuff)return t.warn("Invalid handle"),void o.error("Invalid handle");let s=o.message,a=o.jsep,d=t.randomString(12),u={janus:"message",body:s,transaction:d};if(i.token&&(u.token=i.token),h&&(u.apisecret=h),a){u.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(u.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(u.jsep.rid_order=a.rid_order),a.force_relay&&(u.jsep.force_relay=!0);let e=null,t=i.webrtcStuff;if(t.pc){let n=t.pc.getTransceivers();if(n&&n.length>0)for(let t in n){let r=n[t];if(r&&r.sender&&r.sender.track&&"video"===r.sender.track.kind){let n=r.sender.getParameters();n&&n.encodings&&1===n.encodings.length&&n.encodings[0]&&n.encodings[0].scalabilityMode&&(e||(e=[]),e.push({mindex:parseInt(t),mid:r.mid,svc:n.encodings[0].scalabilityMode}))}}}e&&(u.jsep.svc=e)}if(t.debug("Sending message to plugin (handle="+e+"):"),t.debug(u),n)return u.session_id=C,u.handle_id=e,k.set(d,function(e){if(t.debug("Message sent!"),t.debug(e),"success"===e.janus){let n=e.plugindata;if(!n)return t.warn("Request succeeded, but missing plugindata..."),void o.success();t.log("Synchronous transaction successful ("+n.plugin+")");let r=n.data;return t.debug(r),void o.success(r)}"ack"===e.janus?o.success():e.error?(t.error("Ooops: "+e.error.code+" "+e.error.reason),o.error(e.error.code+" "+e.error.reason)):(t.error("Unknown error"),o.error("Unknown error"))}),void r.send(JSON.stringify(u));t.httpAPICall(c+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:u,success:function(e){if(t.debug("Message sent!"),t.debug(e),"success"===e.janus){let n=e.plugindata;if(!n)return t.warn("Request succeeded, but missing plugindata..."),void o.success();t.log("Synchronous transaction successful ("+n.plugin+")");let r=n.data;return t.debug(r),void o.success(r)}"ack"===e.janus?o.success():e.error?(t.error("Ooops: "+e.error.code+" "+e.error.reason),o.error(e.error.code+" "+e.error.reason)):(t.error("Unknown error"),o.error("Unknown error"))},error:function(e,n){t.error(e+":",n),o.error(e+": "+n)}})}function D(e,o){if(!b)return void t.warn("Is the server down? (connected=false)");let i=S.get(e);if(!i||!i.webrtcStuff)return void t.warn("Invalid handle");let s={janus:"trickle",candidate:o,transaction:t.randomString(12)};if(i.token&&(s.token=i.token),h&&(s.apisecret=h),t.vdebug("Sending trickle candidate (handle="+e+"):"),t.vdebug(s),n)return s.session_id=C,s.handle_id=e,void r.send(JSON.stringify(s));t.httpAPICall(c+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:s,success:function(e){t.vdebug("Candidate sent!"),t.vdebug(e),"ack"===e.janus||t.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,n){t.error(e+":",n)}})}function I(e,n,r,o,i){let s=S.get(e);if(!s||!s.webrtcStuff)return void t.warn("Invalid handle");let a=s.webrtcStuff;if(!a.pc)return void t.warn("Invalid PeerConnection");let c=function(e){t.log("Received state change on data channel:",e);let n=e.target.label,r=e.target.protocol,o=a.dataChannel[n]?a.dataChannel[n].readyState:"null";if(t.log("State change on <"+n+"> data channel: "+o),"open"===o){if(a.dataChannel[n].pending&&a.dataChannel[n].pending.length>0){t.log("Sending pending messages on <"+n+">:",a.dataChannel[n].pending.length);for(let e of a.dataChannel[n].pending)t.log("Sending data on data channel <"+n+">"),t.debug(e),a.dataChannel[n].send(e);a.dataChannel[n].pending=[]}s.ondataopen(n,r)}};if(o)a.dataChannel[n]=o;else{let e=a.dataChannelOptions;r&&(e.protocol=r),a.dataChannel[n]=a.pc.createDataChannel(n,e)}a.dataChannel[n].onmessage=function(e){t.log("Received message on data channel:",e);let n=e.target.label;s.ondata(e.data,n)},a.dataChannel[n].onopen=c,a.dataChannel[n].onclose=c,a.dataChannel[n].onerror=function(e){t.error("Got error on data channel:",e)},a.dataChannel[n].pending=[],i&&a.dataChannel[n].pending.push(i)}function j(e,n){(n=n||{}).success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop;let r=S.get(e);if(!r||!r.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");let o=r.webrtcStuff,i=n.text||n.data;if(!i)return t.warn("Invalid data"),void n.error("Invalid data");let s=n.label?n.label:t.dataChanDefaultLabel;return o.dataChannel[s]?"open"!==o.dataChannel[s].readyState?(o.dataChannel[s].pending.push(i),void n.success()):(t.log("Sending data on data channel <"+s+">"),t.debug(i),o.dataChannel[s].send(i),void n.success()):(I(e,s,n.protocol,!1,i,n.protocol),void n.success())}function _(e,n){(n=n||{}).success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop;let r=S.get(e);if(!r||!r.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");let o=r.webrtcStuff;if(!o.dtmfSender){if(o.pc){let e=o.pc.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});if(!e)return t.warn("Invalid DTMF configuration (no audio track)"),void n.error("Invalid DTMF configuration (no audio track)");o.dtmfSender=e.dtmf,o.dtmfSender&&(t.log("Created DTMF Sender"),o.dtmfSender.ontonechange=function(e){t.debug("Sent DTMF tone: "+e.tone)})}if(!o.dtmfSender)return t.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}let i=n.dtmf;if(!i)return t.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");let s=i.tones;if(!s)return t.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");let a="number"==typeof i.duration?i.duration:500,c="number"==typeof i.gap?i.gap:50;t.debug("Sending DTMF string "+s+" (duration "+a+"ms, gap "+c+"ms)"),o.dtmfSender.insertDTMF(s,a,c),n.success()}function A(e,o){(o=o||{}).success="function"==typeof o.success?o.success:t.noop,o.error="function"==typeof o.error?o.error:t.noop;let i=!0===o.noRequest;t.log("Destroying handle "+e+" (only-locally="+i+")"),H(e);let s=S.get(e);if(!s||s.detached)return S.delete(e),void o.success();if(s.detached=!0,i)return S.delete(e),void o.success();if(!b)return t.warn("Is the server down? (connected=false)"),void o.error("Is the server down? (connected=false)");let a={janus:"detach",transaction:t.randomString(12)};if(s.token&&(a.token=s.token),h&&(a.apisecret=h),n)return a.session_id=C,a.handle_id=e,r.send(JSON.stringify(a)),S.delete(e),void o.success();t.httpAPICall(c+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:a,success:function(n){t.log("Destroyed handle:"),t.debug(n),"success"!==n.janus&&t.error("Ooops: "+n.error.code+" "+n.error.reason),S.delete(e),o.success()},error:function(n,r){t.error(n+":",r),S.delete(e),o.success()}})}async function M(e,n,r){(r=r||{}).success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:B;let o=r.jsep;if(n&&o)return t.error("Provided a JSEP to a createOffer"),void r.error("Provided a JSEP to a createOffer");if(!(n||o&&o.type&&o.sdp))return t.error("A valid JSEP is required for createAnswer"),void r.error("A valid JSEP is required for createAnswer");if(r.media&&!r.tracks){if(r.tracks=t.mediaToTracks(r.media),!0===r.simulcast||!0===r.simulcast2||r.svc)for(let e of r.tracks)if("video"===e.type){!0===r.simulcast||!0===r.simulcast2?e.simulcast=!0:r.svc&&(e.svc=r.svc);break}t.warn("Deprecated media object passed, use tracks instead. Automatically translated to:",r.tracks)}if(r.tracks&&!Array.isArray(r.tracks))return t.error("Tracks must be an array"),void r.error("Tracks must be an array");let i=S.get(e);if(!i||!i.webrtcStuff)return t.warn("Invalid handle"),void r.error("Invalid handle");let s=i.webrtcStuff;var a;s.trickle=(a=r.trickle,t.debug("isTrickleEnabled:",a),!1!==a);try{if(function(e,n){let r=S.get(e);if(!r||!r.webrtcStuff)throw t.warn("Invalid handle"),"Invalid handle";let o=r.webrtcStuff;if(o.pc)return;let i={iceServers:d,iceTransportPolicy:u,bundlePolicy:l,sdpSemantics:"unified-plan"},s=!1;if(n.tracks)for(let e of n.tracks)if(e.transforms&&(e.transforms.sender||e.transforms.receiver)){s=!0;break}n.externalEncryption&&(s=!0,o.externalEncryption=!0),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&s&&(o.insertableStreams=!0,i.forceEncodedAudioInsertableStreams=!0,i.forceEncodedVideoInsertableStreams=!0,i.encodedInsertableStreams=!0),t.log("Creating PeerConnection"),o.pc=new RTCPeerConnection(i),t.debug(o.pc),o.pc.getStats&&(o.volume={},o.bitrate.value="0 kbits/sec"),t.log("Preparing local SDP and gathering candidates (trickle="+o.trickle+")"),o.pc.onconnectionstatechange=function(){o.pc&&r.connectionState(o.pc.connectionState)},o.pc.oniceconnectionstatechange=function(){o.pc&&r.iceState(o.pc.iceConnectionState)},o.pc.onicecandidate=function(r){if(!r.candidate||r.candidate.candidate&&r.candidate.candidate.indexOf("endOfCandidates")>0)t.log("End of candidates."),o.iceDone=!0,!0===o.trickle?D(e,{completed:!0}):function(e,n){(n=n||{}).success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop;let r=S.get(e);if(!r||!r.webrtcStuff)return void t.warn("Invalid handle, not sending anything");let o=r.webrtcStuff;t.log("Sending offer/answer SDP..."),o.mySdp?(o.mySdp={type:o.pc.localDescription.type,sdp:o.pc.localDescription.sdp},!1===o.trickle&&(o.mySdp.trickle=!1),t.debug(n),o.sdpSent=!0,n.success(o.mySdp)):t.warn("Local SDP instance is invalid, not sending anything...")}(e,n);else{let t={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===o.trickle&&D(e,t)}},o.pc.ontrack=function(e){if(t.log("Handling Remote Track",e),!e.streams)return;if(!e.track)return;let n=e.transceiver?e.transceiver.mid:e.track.id;try{e.transceiver&&e.transceiver.mid&&e.track.id&&(r.mids||(r.mids={}),r.mids[e.track.id]=e.transceiver.mid),r.onremotetrack(e.track,n,!0,{reason:"created"})}catch(e){t.error("Error calling onremotetrack",e)}if(e.track.onended)return;let i=null;t.log("Adding onended callback to track:",e.track),e.track.onended=function(n){t.log("Remote track removed:",n),clearTimeout(i);let s=o.pc?o.pc.getTransceivers():null,a=s?s.find(e=>e.receiver.track===n.target):null,c=a?a.mid:n.target.id;c===n.target.id&&r.mids&&r.mids[e.track.id]&&(c=r.mids[e.track.id]);try{r.onremotetrack(n.target,c,!1,{reason:"ended"})}catch(e){t.error("Error calling onremotetrack on removal",e)}delete r.mids[e.track.id]},e.track.onmute=function(n){t.log("Remote track muted:",n),i||(i=setTimeout(function(){t.log("Removing remote track");let s=o.pc?o.pc.getTransceivers():null,a=s?s.find(e=>e.receiver.track===n.target):null,c=a?a.mid:n.target.id;c===n.target.id&&r.mids&&r.mids[e.track.id]&&(c=r.mids[e.track.id]);try{r.onremotetrack(n.target,c,!1,{reason:"mute"})}catch(e){t.error("Error calling onremotetrack on mute",e)}i=null},2520))},e.track.onunmute=function(e){if(t.log("Remote track flowing again:",e),null!=i)clearTimeout(i),i=null;else try{let t=o.pc?o.pc.getTransceivers():null,n=t?t.find(t=>t.receiver.track===e.target):null,i=n?n.mid:e.target.id;r.onremotetrack(e.target,i,!0,{reason:"unmute"})}catch(e){t.error("Error calling onremotetrack on unmute",e)}}}}(e,r),n&&await V(e,r),o){if(await s.pc.setRemoteDescription(o),t.log("Remote description accepted!"),s.remoteSdp=o.sdp,s.candidates&&s.candidates.length>0){for(let e=0;e<s.candidates.length;e++){let n=s.candidates[e];t.debug("Adding remote candidate:",n),n&&!0!==n.completed?s.pc.addIceCandidate(n):s.pc.addIceCandidate(t.endOfCandidates)}s.candidates=[]}await V(e,r);let n=await async function(e,n){(n=n||{}).customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:t.noop;let r=S.get(e);if(!r||!r.webrtcStuff)throw t.warn("Invalid handle"),"Invalid handle";let o=r.webrtcStuff;t.log("Creating answer (iceDone="+o.iceDone+")");let i=await o.pc.createAnswer();t.debug(i);let s={type:"answer",sdp:i.sdp};return n.customizeSdp(s),i.sdp=s.sdp,t.log("Setting local description"),o.mySdp={type:"answer",sdp:i.sdp},await o.pc.setLocalDescription(i),o.iceDone||o.trickle?((o.insertableStreams||o.externalEncryption)&&(i.e2ee=!0),i):(t.log("Waiting for all candidates..."),null)}(e,r);r.success(n)}else{let n=await async function(e,n){(n=n||{}).customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:t.noop;let r=S.get(e);if(!r||!r.webrtcStuff)throw t.warn("Invalid handle"),"Invalid handle";let o=r.webrtcStuff;t.log("Creating offer (iceDone="+o.iceDone+")");let i={};!0===n.iceRestart&&(i.iceRestart=!0),t.debug(i);let s=await o.pc.createOffer(i);t.debug(s);let a={type:"offer",sdp:s.sdp};return n.customizeSdp(a),s.sdp=a.sdp,t.log("Setting local description"),o.mySdp={type:"offer",sdp:s.sdp},await o.pc.setLocalDescription(s),o.mediaConstraints=i,o.iceDone||o.trickle?((o.insertableStreams||o.externalEncryption)&&(s.e2ee=!0),s):(t.log("Waiting for all candidates..."),null)}(e,r);r.success(n)}}catch(e){t.error(e),r.error(e)}}function L(e,n){(n=n||{}).success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:B,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:t.noop;let r=n.jsep,o=S.get(e);if(!o||!o.webrtcStuff)return t.warn("Invalid handle"),void n.error("Invalid handle");let i=o.webrtcStuff;if(r){if(!i.pc)return t.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");n.customizeSdp(r),i.pc.setRemoteDescription(r).then(function(){if(t.log("Remote description accepted!"),i.remoteSdp=r.sdp,i.candidates&&i.candidates.length>0){for(let e=0;e<i.candidates.length;e++){let n=i.candidates[e];t.debug("Adding remote candidate:",n),n&&!0!==n.completed?i.pc.addIceCandidate(n):i.pc.addIceCandidate(t.endOfCandidates)}i.candidates=[]}n.success()},n.error)}else n.error("Invalid JSEP")}async function N(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:t.noop,n.error="function"==typeof n.error?n.error:t.noop,n.tracks&&!Array.isArray(n.tracks))return t.error("Tracks must be an array"),void n.error("Tracks must be an array");for(let e of n.tracks)(e.add||!e.replace&&!e.remove)&&(e.replace=!0);try{await V(e,n),n.success()}catch(e){t.error(e),n.error(e)}}async function V(e,n){let r=S.get(e);if(!r||!r.webrtcStuff)throw t.warn("Invalid handle, not sending anything"),"Invalid handle";let o=r.webrtcStuff;if(!o.pc)throw t.warn("Invalid PeerConnection"),"Invalid PeerConnection";let i=n.tracks;if(!i||!Array.isArray(i)||0===i.length)return;let s=!1,a={};for(let e of i){if(delete e.gumGroup,!e.type||!["audio","video"].includes(e.type))continue;if(!e.capture||e.capture instanceof MediaStreamTrack)continue;let t=e.group?e.group:"default";a[t]||(a[t]={}),a[t][e.type]||(e.gumGroup=t,a[t][e.type]=e)}let c=Object.keys(a);for(let e of c){let t=a[e];t.audio&&t.video||(t.audio&&delete t.audio.gumGroup,t.video&&delete t.video.gumGroup,delete a[e])}let d=!!n.jsep;for(let n of i){if(!n.type){t.warn("Missing track type:",n);continue}if("data"===n.type){if(o.pc.ondatachannel){t.warn("Data channel exists already, not creating another one");continue}t.log("Creating default data channel"),I(e,t.dataChanDefaultLabel,null,!1),o.pc.ondatachannel=function(n){t.log("Data channel created by Janus:",n),I(e,n.channel.label,n.channel.protocol,n.channel)};continue}if(void 0!==n.add&&null!==n.add||void 0!==n.remove&&null!==n.remove||void 0!==n.replace&&null!==n.replace||(n.add=!0),n.add&&n.remove||n.add&&n.remove&&n.replace){t.warn("Conflicting actions for track, ignoring:",n);continue}n.add&&n.replace?(t.warn("Both add and replace provided, falling back to replace:",n),delete n.add):n.remove&&n.replace&&(t.warn("Both remove and replace provided, falling back to remove:",n),delete n.replace);let i=n.type;"screen"===n.type&&(i="video");let c=null,u=null;if(n.mid?c=o.pc.getTransceivers().find(e=>e.mid===n.mid&&e.receiver.track.kind===i):n.add||(c=o.pc.getTransceivers().find(e=>e.receiver.track.kind===i)),n.replace||n.remove){if(!c){t.warn("Couldn't find a transceiver for track:",n);continue}if(!c.sender){t.warn("No sender in the transceiver for track:",n);continue}u=c.sender}if(d&&!c&&(c=o.pc.getTransceivers().find(e=>e.receiver.track.kind===i),!c)){t.warn("Couldn't find a transceiver for track:",n);continue}let l=null,p=null;if((n.remove||n.replace)&&(t.log("Removing track from PeerConnection",n),p=u.track?u.track.id:null,await u.replaceTrack(null),p&&o.myStream)){let e=null;if("audio"===i&&o.myStream.getAudioTracks()&&o.myStream.getAudioTracks().length)for(let n of o.myStream.getAudioTracks())n.id===p&&(e=n,t.log("Removing audio track:",e));else if("video"===i&&o.myStream.getVideoTracks()&&o.myStream.getVideoTracks().length)for(let n of o.myStream.getVideoTracks())n.id===p&&(e=n,t.log("Removing video track:",e));if(e){try{o.myStream.removeTrack(e),r.onlocaltrack(e,!1)}catch(e){t.error("Error calling onlocaltrack on removal for renegotiation",e)}if(!0!==e.dontStop)try{e.stop()}catch(e){}}}if(n.capture){if(n.gumGroup&&a[n.gumGroup]&&a[n.gumGroup].stream){let e=a[n.gumGroup].stream;l="audio"===n.type?e.getAudioTracks()[0]:e.getVideoTracks()[0],delete a[n.gumGroup].stream,delete a[n.gumGroup],delete n.gumGroup}else if(n.capture instanceof MediaStreamTrack)l=n.capture;else{s||(s=!0,r.consentDialog(!0));let e=t.trackConstraints(n),o=null;if("audio"===n.type||"video"===n.type){if(n.gumGroup){let r="audio"===n.type?"video":"audio";if(a[n.gumGroup]&&a[n.gumGroup][r]){let o=a[n.gumGroup][r],i=t.trackConstraints(o);e[r]=i[r]}}o=await navigator.mediaDevices.getUserMedia(e),n.gumGroup&&e.audio&&e.video&&(a[n.gumGroup].stream=o,delete n.gumGroup)}else o=await navigator.mediaDevices.getDisplayMedia(e);l="audio"===n.type?o.getAudioTracks()[0]:o.getVideoTracks()[0]}if(n.replace){await u.replaceTrack(l);let e="sendrecv";!1!==n.recv&&"inactive"!==c.direction&&"sendonly"!==c.direction||(e="sendonly"),c.setDirection?c.setDirection(e):c.direction=e}else{if(o.myStream||(o.myStream=new MediaStream),"audio"===i||!n.simulcast&&!n.svc)u=o.pc.addTrack(l,o.myStream),c=o.pc.getTransceivers().find(e=>e.sender===u);else if(n.simulcast){t.log("Enabling rid-based simulcasting:",l);let e=y(n.simulcastMaxBitrates);c=o.pc.addTransceiver(l,{direction:"sendrecv",streams:[o.myStream],sendEncodings:n.sendEncodings||[{rid:"h",active:!0,scalabilityMode:"L1T2",maxBitrate:e.high},{rid:"m",active:!0,scalabilityMode:"L1T2",maxBitrate:e.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,scalabilityMode:"L1T2",maxBitrate:e.low,scaleResolutionDownBy:4}]})}else t.log("Enabling SVC ("+n.svc+"):",l),c=o.pc.addTransceiver(l,{direction:"sendrecv",streams:[o.myStream],sendEncodings:[{scalabilityMode:n.svc}]});if(u||(u=c?c.sender:null),n.codec)if("firefox"===t.webRTCAdapter.browserDetails.browser)t.warn("setCodecPreferences not supported in Firefox, ignoring codec for track:",n);else if("string"!=typeof n.codec)t.warn("Invalid codec value, ignoring for track:",n);else{let e=i+"/"+n.codec.toLowerCase(),r=RTCRtpReceiver.getCapabilities(i).codecs.filter(function(t){return t.mimeType.toLowerCase()===e});if(r&&0!==r.length){if(c)try{c.setCodecPreferences(r)}catch(e){t.warn("Failed enforcing codec for this "+i+" track:",e)}}else t.warn("Codec not supported in this browser for this track, ignoring:",n)}if(n.bitrate)if(n.simulcast||n.svc)t.warn("Ignoring bitrate for simulcast/SVC track, use sendEncodings for that");else if(isNaN(n.bitrate)||n.bitrate<0)t.warn("Ignoring invalid bitrate for track:",n);else if(u){let e=u.getParameters();e&&e.encodings&&0!==e.encodings.length?(e.encodings[0].maxBitrate=n.bitrate,await u.setParameters(e)):t.warn("No encodings in the sender parameters, ignoring bitrate for track:",n)}if("video"===i&&n.framerate)if(n.simulcast||n.svc)t.warn("Ignoring framerate for simulcast/SVC track, use sendEncodings for that");else if(isNaN(n.framerate)||n.framerate<0)t.warn("Ignoring invalid framerate for track:",n);else if(u){let e=u.getParameters();e&&e.encodings&&0!==e.encodings.length?(e.encodings[0].maxFramerate=n.framerate,await u.setParameters(e)):t.warn("No encodings in the sender parameters, ignoring framerate for track:",n)}if(n.transforms){if(u&&n.transforms.sender){let e=null;RTCRtpSender.prototype.createEncodedStreams?e=u.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===i?e=u.createEncodedAudioStreams():"video"===i&&(e=u.createEncodedVideoStreams())),e&&(e.readableStream&&e.writableStream?e.readableStream.pipeThrough(n.transforms.sender).pipeTo(e.writableStream):e.readable&&e.writable&&e.readable.pipeThrough(n.transforms.sender).pipeTo(e.writable))}if(c&&c.receiver&&n.transforms.receiver){let e=null;RTCRtpReceiver.prototype.createEncodedStreams?e=c.receiver.createEncodedStreams():(RTCRtpReceiver.prototype.createAudioEncodedStreams||RTCRtpReceiver.prototype.createEncodedVideoStreams)&&("audio"===i?e=c.receiver.createEncodedAudioStreams():"video"===i&&(e=c.receiver.createEncodedVideoStreams())),e&&(e.readableStream&&e.writableStream?e.readableStream.pipeThrough(n.transforms.receiver).pipeTo(e.writableStream):e.readable&&e.writable&&e.readable.pipeThrough(n.transforms.receiver).pipeTo(e.writable))}}}l&&!0===n.dontStop&&(l.dontStop=!0)}else if(n.recv&&(c||(c=o.pc.addTransceiver(i)),c)){if(n.codec)if("firefox"===t.webRTCAdapter.browserDetails.browser)t.warn("setCodecPreferences not supported in Firefox, ignoring codec for track:",n);else if("string"!=typeof n.codec)t.warn("Invalid codec value, ignoring for track:",n);else{let e=i+"/"+n.codec.toLowerCase(),r=RTCRtpReceiver.getCapabilities(i).codecs.filter(function(t){return t.mimeType.toLowerCase()===e});if(r&&0!==r.length)try{c.setCodecPreferences(r)}catch(e){t.warn("Failed enforcing codec for this "+i+" track:",e)}else t.warn("Codec not supported in this browser for this track, ignoring:",n)}if(c.receiver&&n.transforms&&n.transforms.receiver){let e=null;RTCRtpReceiver.prototype.createEncodedStreams?e=c.receiver.createEncodedStreams():(RTCRtpReceiver.prototype.createAudioEncodedStreams||RTCRtpReceiver.prototype.createEncodedVideoStreams)&&("audio"===i?e=c.receiver.createEncodedAudioStreams():"video"===i&&(e=c.receiver.createEncodedVideoStreams())),e&&(e.readableStream&&e.writableStream?e.readableStream.pipeThrough(n.transforms.receiver).pipeTo(e.writableStream):e.readable&&e.writable&&e.readable.pipeThrough(n.transforms.receiver).pipeTo(e.writable))}}if(l){o.myStream.addTrack(l),l.onended=function(e){t.log("Local track removed:",e);try{r.onlocaltrack(e.target,!1)}catch(e){t.error("Error calling onlocaltrack following end",e)}};try{r.onlocaltrack(l,!0)}catch(e){t.error("Error calling onlocaltrack for track add",e)}}if(c){let e=c.direction,r=null,o=l&&c.sender.track,i=!1!==n.recv&&c.receiver.track;o&&i?r="sendrecv":o&&!i?r="sendonly":!o&&i?r="recvonly":o||i||(r="inactive"),r&&r!==e&&(t.warn("Changing direction of transceiver to "+r+" (was "+e+")",n),c.setDirection?c.setDirection(r):c.direction=r)}}s&&r.consentDialog(!1)}function F(e){let n=S.get(e);if(!n||!n.webrtcStuff)return t.warn("Invalid handle"),null;let r=n.webrtcStuff;if(!r.pc)return t.warn("Invalid PeerConnection"),null;let o=[],i=r.pc.getTransceivers();for(let e of i){let t=null;e.sender&&e.sender.track&&(t={mid:e.mid},t.type=e.sender.track.kind,t.id=e.sender.track.id,t.label=e.sender.track.label),t&&o.push(t)}return o}function G(e){let n=S.get(e);if(!n||!n.webrtcStuff)return t.warn("Invalid handle"),null;let r=n.webrtcStuff;if(!r.pc)return t.warn("Invalid PeerConnection"),null;let o=[],i=r.pc.getTransceivers();for(let e of i){let t=null;e.receiver&&e.receiver.track&&(t={mid:e.mid},t.type=e.receiver.track.kind,t.id=e.receiver.track.id,t.label=e.receiver.track.label),t&&o.push(t)}return o}function U(e,n,r,o){o="function"==typeof o?o:t.noop;let i=S.get(e);if(!i||!i.webrtcStuff)return t.warn("Invalid handle"),void o(0);let s=r?"remote":"local",a=i.webrtcStuff;if(a.volume[s]||(a.volume[s]={value:0}),a.pc&&a.pc.getStats&&("chrome"===t.webRTCAdapter.browserDetails.browser||"safari"===t.webRTCAdapter.browserDetails.browser)){let e=a.pc;if(n){let i=a.pc.getTransceivers().find(e=>e.mid===n&&"audio"===e.receiver.track.kind);if(!i)return t.warn("No audio transceiver with mid "+n),void o(0);if(r&&!i.receiver)return t.warn("Remote transceiver track unavailable"),void o(0);if(!r&&!i.sender)return t.warn("Local transceiver track unavailable"),void o(0);e=r?i.receiver:i.sender}return e.getStats().then(function(e){e.forEach(function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||o(e.audioLevel?e.audioLevel:0))})}),a.volume[s].value}return t.warn("Getting the "+s+" volume unsupported by browser"),void o(0)}function J(e,n,r){let o=S.get(e);if(!o||!o.webrtcStuff)return t.warn("Invalid handle"),!0;let i=o.webrtcStuff;if(!i.pc)return t.warn("Invalid PeerConnection"),!0;if(!i.myStream)return t.warn("Invalid local MediaStream"),!0;if(r){if(!i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length)return t.warn("No video track"),!0;if(n){let e=i.pc.getTransceivers().find(e=>e.mid===n&&"video"===e.receiver.track.kind);return e?e.sender&&e.sender.track?!e.sender.track.enabled:(t.warn("No video sender with mid "+n),!0):(t.warn("No video transceiver with mid "+n),!0)}return!i.myStream.getVideoTracks()[0].enabled}if(!i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length)return t.warn("No audio track"),!0;if(n){let e=i.pc.getTransceivers().find(e=>e.mid===n&&"audio"===e.receiver.track.kind);return e?e.sender&&e.sender.track?!e.sender.track.enabled:(t.warn("No audio sender with mid "+n),!0):(t.warn("No audio transceiver with mid "+n),!0)}return!i.myStream.getAudioTracks()[0].enabled}function q(e,n,r,o){let i=S.get(e);if(!i||!i.webrtcStuff)return t.warn("Invalid handle"),!1;let s=i.webrtcStuff;if(!s.pc)return t.warn("Invalid PeerConnection"),!1;if(!s.myStream)return t.warn("Invalid local MediaStream"),!1;if(r){if(!s.myStream.getVideoTracks()||0===s.myStream.getVideoTracks().length)return t.warn("No video track"),!1;if(n){let e=s.pc.getTransceivers().find(e=>e.mid===n&&"video"===e.receiver.track.kind);if(!e)return t.warn("No video transceiver with mid "+n),!1;if(!e.sender||!e.sender.track)return t.warn("No video sender with mid "+n),!1;e.sender.track.enabled=!o}else for(const e of s.myStream.getVideoTracks())e.enabled=!o}else{if(!s.myStream.getAudioTracks()||0===s.myStream.getAudioTracks().length)return t.warn("No audio track"),!1;if(n){let e=s.pc.getTransceivers().find(e=>e.mid===n&&"audio"===e.receiver.track.kind);if(!e)return t.warn("No audio transceiver with mid "+n),!1;if(!e.sender||!e.sender.track)return t.warn("No audio sender with mid "+n),!1;e.sender.track.enabled=!o}else for(const e of s.myStream.getAudioTracks())e.enabled=!o}return!0}function z(e,n){let r=S.get(e);if(!r||!r.webrtcStuff)return t.warn("Invalid handle"),"Invalid handle";let o=r.webrtcStuff;if(!o.pc)return"Invalid PeerConnection";if(o.pc.getStats){let e=o.pc,r=n||"default";if(n){let r=o.pc.getTransceivers().find(e=>e.mid===n&&"video"===e.receiver.track.kind);if(!r)return t.warn("No video transceiver with mid "+n),"No video transceiver with mid "+n;if(!r.receiver)return t.warn("No video receiver with mid "+n),"No video receiver with mid "+n;e=r.receiver}return o.bitrate[r]||(o.bitrate[r]={timer:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,value:"0 kbits/sec"}),o.bitrate[r].timer?o.bitrate[r].value:(t.log("Starting bitrate timer"+(n?" for mid "+n:"")+" (via getStats)"),o.bitrate[r].timer=setInterval(function(){e.getStats().then(function(e){e.forEach(function(e){if(!e)return;let n=!1;if(("video"===e.mediaType||"video"===e.kind||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?n=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(n=!0),n)if(o.bitrate[r].bsnow=e.bytesReceived,o.bitrate[r].tsnow=e.timestamp,null===o.bitrate[r].bsbefore||null===o.bitrate[r].tsbefore)o.bitrate[r].bsbefore=o.bitrate[r].bsnow,o.bitrate[r].tsbefore=o.bitrate[r].tsnow;else{let e=o.bitrate[r].tsnow-o.bitrate[r].tsbefore;"safari"===t.webRTCAdapter.browserDetails.browser&&(e/=1e3);let n=Math.round(8*(o.bitrate[r].bsnow-o.bitrate[r].bsbefore)/e);"safari"===t.webRTCAdapter.browserDetails.browser&&(n=parseInt(n/1e3)),o.bitrate[r].value=n+" kbits/sec",o.bitrate[r].bsbefore=o.bitrate[r].bsnow,o.bitrate[r].tsbefore=o.bitrate[r].tsnow}})})},1e3),"0 kbits/sec")}return t.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function W(e,n,r){let o=S.get(e);if(!o||!o.webrtcStuff)return void t.warn("Invalid handle");let i=o.webrtcStuff;if(!i.pc)return void t.warn("Invalid PeerConnection");let s=i.pc.getTransceivers().find(e=>e.mid===n);if(!s)return void t.warn("No transceiver with mid",n);if(!s.sender)return void t.warn("No sender for transceiver with mid",n);let a=s.sender.getParameters();a&&a.encodings&&0!==a.encodings.length?a.encodings.length>1?t.warn("Ignoring bitrate for simulcast track, use sendEncodings for that"):isNaN(r)||r<0?t.warn("Invalid bitrate (must be a positive integer)"):(a.encodings[0].maxBitrate=r,s.sender.setParameters(a)):t.warn("No parameters encodings")}function B(e){t.error("WebRTC error:",e)}function H(e,o){t.log("Cleaning WebRTC stuff");let i=S.get(e);if(!i)return;let s=i.webrtcStuff;if(s){if(!0===o){let o={janus:"hangup",transaction:t.randomString(12)};i.token&&(o.token=i.token),h&&(o.apisecret=h),t.debug("Sending hangup request (handle="+e+"):"),t.debug(o),n?(o.session_id=C,o.handle_id=e,r.send(JSON.stringify(o))):t.httpAPICall(c+"/"+C+"/"+e,{verb:"POST",withCredentials:p,body:o})}s.volume&&(s.volume.local&&s.volume.local.timer&&clearInterval(s.volume.local.timer),s.volume.remote&&s.volume.remote.timer&&clearInterval(s.volume.remote.timer));for(let e in s.bitrate)s.bitrate[e].timer&&clearInterval(s.bitrate[e].timer);s.bitrate={},!s.streamExternal&&s.myStream&&(t.log("Stopping local stream tracks"),t.stopAllTracks(s.myStream)),s.streamExternal=!1,s.myStream=null;try{s.pc.close()}catch(e){}s.pc=null,s.candidates=null,s.mySdp=null,s.remoteSdp=null,s.iceDone=!1,s.dataChannel={},s.dtmfSender=null,s.insertableStreams=!1,s.externalEncryption=!1}i.oncleanup()}x(e),this.getServer=function(){return c},this.isConnected=function(){return b},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,e.reconnect=!0,x(e)},this.getSessionId=function(){return C},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,t.log("Getting info on Janus instance"),!b)return t.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");let o=t.randomString(12),i={janus:"info",transaction:o};if(m&&(i.token=m),h&&(i.apisecret=h),n)return k.set(o,function(n){t.log("Server info:"),t.debug(n),"server_info"!==n.janus&&t.error("Ooops: "+n.error.code+" "+n.error.reason),e.success(n)}),void r.send(JSON.stringify(i));t.httpAPICall(c,{verb:"POST",withCredentials:p,body:i,success:function(n){t.log("Server info:"),t.debug(n),"server_info"!==n.janus&&t.error("Ooops: "+n.error.code+" "+n.error.reason),e.success(n)},error:function(n,r){t.error(n+":",r),""===r?e.error(n+": Is the server down?"):e.error(n+": "+r)}})}(e)},this.destroy=function(s){!function(s){(s=s||{}).success="function"==typeof s.success?s.success:t.noop,s.error="function"==typeof s.error?s.error:t.noop;let a=!0===s.unload,d=!0;void 0!==s.notifyDestroyed&&null!==s.notifyDestroyed&&(d=!0===s.notifyDestroyed);let u=!0===s.cleanupHandles;if(t.log("Destroying session "+C+" (unload="+a+")"),!C)return t.warn("No session to destroy"),s.success(),void(d&&e.destroyed());if(u)for(const e of S.keys())A(e,{noRequest:!0});if(!b)return t.warn("Is the server down? (connected=false)"),C=null,void s.success();let l={janus:"destroy",transaction:t.randomString(12)};if(m&&(l.token=m),h&&(l.apisecret=h),a)return n?(r.onclose=null,r.close(),r=null):navigator.sendBeacon(c+"/"+C,JSON.stringify(l)),t.log("Destroyed session:"),C=null,b=!1,s.success(),void(d&&e.destroyed());if(n){l.session_id=C;let t=function(){for(let e in o)r.removeEventListener(e,o[e]);r.removeEventListener("message",n),r.removeEventListener("error",a),i&&clearTimeout(i),r.close()},n=function(n){let r=JSON.parse(n.data);r.session_id==l.session_id&&r.transaction==l.transaction&&(t(),s.success(),d&&e.destroyed())},a=function(){t(),s.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()};return r.addEventListener("message",n),r.addEventListener("error",a),void(1===r.readyState?r.send(JSON.stringify(l)):a())}t.httpAPICall(c+"/"+C,{verb:"POST",withCredentials:p,body:l,success:function(n){t.log("Destroyed session:"),t.debug(n),C=null,b=!1,"success"!==n.janus&&t.error("Ooops: "+n.error.code+" "+n.error.reason),s.success(),d&&e.destroyed()},error:function(n,r){t.error(n+":",r),C=null,b=!1,s.success(),d&&e.destroyed()}})}(s)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:t.noop,e.error="function"==typeof e.error?e.error:t.noop,e.dataChannelOptions=e.dataChannelOptions||{ordered:!0},e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:t.noop,e.connectionState="function"==typeof e.connectionState?e.connectionState:t.noop,e.iceState="function"==typeof e.iceState?e.iceState:t.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:t.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:t.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:t.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:t.noop,e.onlocaltrack="function"==typeof e.onlocaltrack?e.onlocaltrack:t.noop,e.onremotetrack="function"==typeof e.onremotetrack?e.onremotetrack:t.noop,e.ondata="function"==typeof e.ondata?e.ondata:t.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:t.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:t.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:t.noop,!b)return t.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");let o=e.plugin;if(!o)return t.error("Invalid plugin"),void e.error("Invalid plugin");let i=e.opaqueId,s=e.loopIndex,a=e.token?e.token:m,d=t.randomString(12),u={janus:"attach",plugin:o,opaque_id:i,loop_index:s,transaction:d};if(a&&(u.token=a),h&&(u.apisecret=h),n)return k.set(d,function(n){if(t.debug(n),"success"!==n.janus)return t.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);let r=n.data.id;t.log("Created handle: "+r);let i={session:w,plugin:o,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return r},getPlugin:function(){return o},getVolume:function(e,t){return U(r,e,!0,t)},getRemoteVolume:function(e,t){return U(r,e,!0,t)},getLocalVolume:function(e,t){return U(r,e,!1,t)},isAudioMuted:function(e){return J(r,e,!1)},muteAudio:function(e){return q(r,e,!1,!0)},unmuteAudio:function(e){return q(r,e,!1,!1)},isVideoMuted:function(e){return J(r,e,!0)},muteVideo:function(e){return q(r,e,!0,!0)},unmuteVideo:function(e){return q(r,e,!0,!1)},getBitrate:function(e){return z(r,e)},setMaxBitrate:function(e,t){return W(r,e,t)},send:function(e){O(r,e)},data:function(e){j(r,e)},dtmf:function(e){_(r,e)},consentDialog:e.consentDialog,connectionState:e.connectionState,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){M(r,!0,e)},createAnswer:function(e){M(r,!1,e)},handleRemoteJsep:function(e){L(r,e)},replaceTracks:function(e){N(r,e)},getLocalTracks:function(){return F(r)},getRemoteTracks:function(){return G(r)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){H(r,!0===e)},detach:function(e){A(r,e)}};S.set(r,i),e.success(i)}),u.session_id=C,void r.send(JSON.stringify(u));t.httpAPICall(c+"/"+C,{verb:"POST",withCredentials:p,body:u,success:function(n){if(t.debug(n),"success"!==n.janus)return t.error("Ooops: "+n.error.code+" "+n.error.reason),void e.error("Ooops: "+n.error.code+" "+n.error.reason);let r=n.data.id;t.log("Created handle: "+r);let i={session:w,plugin:o,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return r},getPlugin:function(){return o},getVolume:function(e,t){return U(r,e,!0,t)},getRemoteVolume:function(e,t){return U(r,e,!0,t)},getLocalVolume:function(e,t){return U(r,e,!1,t)},isAudioMuted:function(e){return J(r,e,!1)},muteAudio:function(e){return q(r,e,!1,!0)},unmuteAudio:function(e){return q(r,e,!1,!1)},isVideoMuted:function(e){return J(r,e,!0)},muteVideo:function(e){return q(r,e,!0,!0)},unmuteVideo:function(e){return q(r,e,!0,!1)},getBitrate:function(e){return z(r,e)},setMaxBitrate:function(e,t){return W(r,e,t)},send:function(e){O(r,e)},data:function(e){j(r,e)},dtmf:function(e){_(r,e)},consentDialog:e.consentDialog,connectionState:e.connectionState,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){M(r,!0,e)},createAnswer:function(e){M(r,!1,e)},handleRemoteJsep:function(e){L(r,e)},replaceTracks:function(e){N(r,e)},getLocalTracks:function(){return F(r)},getRemoteTracks:function(){return G(r)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){H(r,!0===e)},detach:function(e){A(r,e)}};S.set(r,i),e.success(i)},error:function(n,r){t.error(n+":",r),""===r?e.error(n+": Is the server down?"):e.error(n+": "+r)}})}(e)}}return t.useDefaultDependencies=function(n){let r=n&&n.fetch||fetch,o=n&&n.Promise||Promise,i=n&&n.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new i(e,t)},extension:n&&n.extension||e,isArray:function(e){return Array.isArray(e)},webRTCAdapter:n&&n.adapter||adapter,httpAPICall:function(e,n){let i={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(i.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(i.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(i.body=JSON.stringify(n.body));let s=r(e,i).catch(function(e){return o.reject({message:"Probably a network error, is the server down?",error:e})});if(n.timeout){let e=new o(function(e,t){let r=setTimeout(function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})},n.timeout)});s=o.race([s,e])}return s.then(function(e){return e.ok?typeof n.success==typeof t.noop?e.json().then(function(e){try{n.success(e)}catch(e){t.error("Unhandled httpAPICall success callback error",e)}},function(t){return o.reject({message:"Failed to parse response body",error:t,response:e})}):void 0:o.reject({message:"API call failed",response:e})}).catch(function(e){typeof n.error==typeof t.noop&&n.error(e.message||"<< internal error >>",e)}),s}}},t.useOldDependencies=function(n){let r=n&&n.jQuery||jQuery,o=n&&n.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new o(e,t)},isArray:function(e){return r.isArray(e)},extension:n&&n.extension||e,webRTCAdapter:n&&n.adapter||adapter,httpAPICall:function(e,n){let o=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},i=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return r.ajax(r.extend(o,i,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){typeof n.success==typeof t.noop&&n.success(e)},error:function(e,r,o){typeof n.error==typeof t.noop&&n.error(r,o)}}))}}},t.mediaToTracks=function(e){let t=[];if(e){if(!e.keepAudio&&!1!==e.audio&&(void 0===e.audio||e.audio||e.audioSend||e.audioRecv||e.addAudio||e.replaceAudio||e.removeAudio)){let n={type:"audio"};e.removeAudio?n.remove=!0:(e.addAudio?n.add=!0:e.replaceAudio&&(n.replace=!0),!1!==e.audioSend&&(n.capture=e.audio||!0),!1!==e.audioRecv&&(n.recv=!0)),(n.remove||n.capture||n.recv)&&t.push(n)}if(!e.keepVideo&&!1!==e.video&&(void 0===e.video||e.video||e.videoSend||e.videoRecv||e.addVideo||e.replaceVideo||e.removeVideo)){let n={type:"video"};e.removeVideo?n.remove=!0:(e.addVideo?n.add=!0:e.replaceVideo&&(n.replace=!0),!1!==e.videoSend&&(n.capture=e.video||!0,["screen","window","desktop"].includes(n.capture)&&(n.type="screen",n.capture={video:{}},e.screenshareFrameRate&&(n.capture.frameRate=e.screenshareFrameRate),e.screenshareHeight&&(n.capture.height=e.screenshareHeight),e.screenshareWidth&&(n.capture.width=e.screenshareWidth))),!1!==e.videoRecv&&(n.recv=!0)),(n.remove||n.capture||n.recv)&&t.push(n)}e.data&&t.push({type:"data"})}else t.push({type:"audio",capture:!0,recv:!0}),t.push({type:"video",capture:!0,recv:!0});return t},t.trackConstraints=function(e){let n={};if(!e||!e.capture)return n;if("audio"===e.type)n.audio=e.capture;else if("video"===e.type)if((e.simulcast||e.svc)&&!0===e.capture&&(e.capture="hires"),!0===e.capture||"object"==typeof e.capture)n.video=e.capture;else{let r=0,o=0;"lowres"===e.capture?(r=320,o=240):"lowres-16:9"===e.capture?(r=320,o=180):"hires"===e.capture||"hires-16:9"===e.capture||"hdres"===e.capture?(r=1280,o=720):"fhdres"===e.capture?(r=1920,o=1080):"4kres"===e.capture?(r=3840,o=2160):"stdres"===e.capture?(r=640,o=480):"stdres-16:9"===e.capture?(r=640,o=360):(t.log("Default video setting is stdres 4:3"),r=640,o=480),n.video={width:{ideal:r},height:{ideal:o}}}else"screen"===e.type&&(n.video=e.capture);return n},t.noop=function(){},t.dataChanDefaultLabel="JanusDataChannel",t.endOfCandidates=null,t.stopAllTracks=function(e){try{let n=e.getTracks();for(let e of n)t.log(e),e&&!0!==e.dontStop&&e.stop()}catch(e){}},t.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:t.noop,t.initDone)e.callback();else{if(void 0===console.log&&(console.log=function(){}),t.trace=t.noop,t.debug=t.noop,t.vdebug=t.noop,t.log=t.noop,t.warn=t.noop,t.error=t.noop,!0===e.debug||"all"===e.debug)t.trace=console.trace.bind(console),t.debug=console.debug.bind(console),t.vdebug=console.debug.bind(console),t.log=console.log.bind(console),t.warn=console.warn.bind(console),t.error=console.error.bind(console);else if(Array.isArray(e.debug))for(let n of e.debug)switch(n){case"trace":t.trace=console.trace.bind(console);break;case"debug":t.debug=console.debug.bind(console);break;case"vdebug":t.vdebug=console.debug.bind(console);break;case"log":t.log=console.log.bind(console);break;case"warn":t.warn=console.warn.bind(console);break;case"error":t.error=console.error.bind(console)}t.log("Initializing library");let n=e.dependencies||t.useDefaultDependencies();t.isArray=n.isArray,t.webRTCAdapter=n.webRTCAdapter,t.httpAPICall=n.httpAPICall,t.newWebSocket=n.newWebSocket,t.extension=n.extension,t.extension.init(),t.listDevices=function(e,n){e="function"==typeof e?e:t.noop,n||(n={audio:!0,video:!0}),t.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(n).then(function(n){navigator.mediaDevices.enumerateDevices().then(function(r){t.debug(r),e(r),t.stopAllTracks(n)})}).catch(function(n){t.error(n),e([])}):(t.warn("navigator.mediaDevices unavailable"),e([]))},t.attachMediaStream=function(e,n){try{e.srcObject=n}catch(r){try{e.src=URL.createObjectURL(n)}catch(e){t.error("Error attaching stream to element",e)}}},t.reattachMediaStream=function(e,n){try{e.srcObject=n.srcObject}catch(r){try{e.src=n.src}catch(e){t.error("Error reattaching stream to element",e)}}};let r=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",o=window["on"+r];if(window.addEventListener(r,function(){t.log("Closing window");for(const[e,n]of t.sessions)n&&n.destroyOnUnload&&(t.log("Destroying session "+e),n.destroy({unload:!0,notifyDestroyed:!1}));o&&"function"==typeof o&&o()}),t.safariVp8=!1,t.safariVp9=!1,"safari"===t.webRTCAdapter.browserDetails.browser&&t.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(let e of RTCRtpSender.getCapabilities("video").codecs)e&&e.mimeType&&"video/vp8"===e.mimeType.toLowerCase()?t.safariVp8=!0:e&&e.mimeType&&"video/vp9"===e.mimeType.toLowerCase()&&(t.safariVp9=!0);t.safariVp8?t.log("This version of Safari supports VP8"):t.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{let e=new RTCPeerConnection({});e.createOffer({offerToReceiveVideo:!0}).then(function(n){t.safariVp8=-1!==n.sdp.indexOf("VP8"),t.safariVp9=-1!==n.sdp.indexOf("VP9"),t.safariVp8?t.log("This version of Safari supports VP8"):t.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),e.close(),e=null})}t.initDone=!0,e.callback()}},t.isWebrtcSupported=function(){return!!window.RTCPeerConnection},t.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},t.randomString=function(e){let t="";for(let n=0;n<e;n++){let e=Math.floor(62*Math.random());t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(e)}return t},t})},156(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.Janus=void 0,t.createVideoRoomClient=function(e){return r(this,void 0,void 0,function*(){return yield new Promise(t=>i.default.init(Object.assign(Object.assign({},e),{callback:t}))),{createSession:s}})};const o=n(281);window.adapter||(window.adapter=o.default);const i=n(35);function s(e,t){return r(this,void 0,void 0,function*(){const n=p();let o;return yield new Promise(function(r,s){let a=!1;o=new i.default(Object.assign(Object.assign({},t),{server:e,success(){a||(r(),a=!0)},error(e){a?"string"==typeof e&&e.startsWith("Lost connection")?n.dispatchEvent(new CustomEvent("connectionLost")):console.error(e):(s(e),a=!0)}}))}),{eventTarget:n,isValid:()=>o.isConnected(),joinRoom:e=>function(e,t){return r(this,void 0,void 0,function*(){const n=u(),o=l();try{const i=yield a(e,"janus.plugin.videoroom");n.add(function(){return r(this,void 0,void 0,function*(){yield new Promise(function(e,t){i.detach({success:e,error:t})})})}),i.eventTarget.addEventListener("message",function(e){const n=e.detail.message;"event"==n.videoroom&&n.room==t&&(n.publishers&&o.get("onPublisherAdded").then(e=>e(n.publishers)).catch(console.error),n.unpublished&&o.get("onPublisherRemoved").then(e=>e(n.unpublished)).catch(console.error))});const s=yield i.sendAsyncRequest({message:{request:"join",ptype:"publisher",room:t},expectResponse:e=>"joined"==e.message.videoroom&&e.message.room==t});return s.message.publishers.length&&o.get("onPublisherAdded").then(e=>e(s.message.publishers)).catch(console.error),{roomId:t,pluginHandle:i,onPublisherAdded(e){o.set("onPublisherAdded",e)},onPublisherRemoved(e){o.set("onPublisherRemoved",e)},publish:e=>function(e,t,n){return r(this,void 0,void 0,function*(){const o=Object.assign({},n),i=u(),s=l(),a=function(e){e.detail.added?s.get("onTrackAdded").then(t=>t(e.detail.track)).catch(console.error):s.get("onTrackRemoved").then(t=>t(e.detail.track)).catch(console.error)};e.eventTarget.addEventListener("localtrack",a),i.add(function(){e.eventTarget.removeEventListener("localtrack",a)});try{const n=yield new Promise(function(t,n){e.createOffer(Object.assign(Object.assign({},o.mediaOptions),{success:t,error:n}))}),a=yield e.sendAsyncRequest({message:Object.assign(Object.assign({},o.publishOptions),{request:"publish"}),jsep:n,expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.configured});return i.add(function(){return r(this,void 0,void 0,function*(){yield e.sendAsyncRequest({message:{request:"unpublish"},expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.unpublished})})}),yield new Promise(function(t,n){var r;e.handleRemoteJsep({jsep:a.jsep,success:t,error:n,customizeSdp:null===(r=o.mediaOptions)||void 0===r?void 0:r.customizeRemoteSdp})}),{publisherId:t,onTrackAdded(e){s.set("onTrackAdded",e)},onTrackRemoved(e){s.set("onTrackRemoved",e)},configure(t){return r(this,void 0,void 0,function*(){yield e.sendAsyncRequest({message:Object.assign(Object.assign({},t),{request:"configure"}),expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.configured})})},restart(){return r(this,arguments,void 0,function*(t=o.mediaOptions,n){const r=yield new Promise(function(n,r){e.createOffer(Object.assign(Object.assign({},t),{success:n,error:r}))}),i=yield e.sendAsyncRequest({message:Object.assign(Object.assign({},n),{request:"configure"}),jsep:r,expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.configured});yield new Promise(function(n,r){e.handleRemoteJsep({jsep:i.jsep,customizeSdp:null==t?void 0:t.customizeRemoteSdp,success:n,error:r})}),o.mediaOptions=t})},unpublish(){return r(this,void 0,void 0,function*(){yield i.run()})}}}catch(e){throw yield i.run().catch(console.error),e}})}(i,s.message.id,e),subscribe:(n,r)=>c(e,t,n,r),leave(){return r(this,void 0,void 0,function*(){yield n.run()})}}}catch(e){throw yield n.run().catch(console.error),e}})}(o,e),subscribe:(e,t,n)=>c(o,e,t,n),watch:(e,t)=>function(e,t,n){return r(this,void 0,void 0,function*(){const o=u(),i=l();try{const s=yield a(e,"janus.plugin.streaming");o.add(function(){return r(this,void 0,void 0,function*(){yield new Promise(function(e,t){s.detach({success:e,error:t})})})}),s.eventTarget.addEventListener("remotetrack",function(e){e.detail.added?i.get("onTrackAdded").then(t=>t(e.detail.track,e.detail.mid)).catch(console.error):i.get("onTrackRemoved").then(t=>t(e.detail.track,e.detail.mid)).catch(console.error)});const c=yield s.sendAsyncRequest({message:Object.assign(Object.assign({},null==n?void 0:n.watchOptions),{request:"watch",id:t}),expectResponse:e=>{var t;return"event"==e.message.streaming&&"preparing"==(null===(t=e.message.result)||void 0===t?void 0:t.status)}});if(!c.jsep)throw new Error("Missing offer Jsep");return yield d(s,c.jsep,null==n?void 0:n.mediaOptions),{pluginHandle:s,onTrackAdded(e){i.set("onTrackAdded",e)},onTrackRemoved(e){i.set("onTrackRemoved",e)},pause(){return r(this,void 0,void 0,function*(){yield s.sendAsyncRequest({message:{request:"pause"},expectResponse:e=>{var t;return"event"==e.message.streaming&&"pausing"==(null===(t=e.message.result)||void 0===t?void 0:t.status)}})})},resume(){return r(this,void 0,void 0,function*(){yield s.sendAsyncRequest({message:{request:"start"},expectResponse:e=>{var t;return"event"==e.message.streaming&&"starting"==(null===(t=e.message.result)||void 0===t?void 0:t.status)}})})},configure(e){return r(this,void 0,void 0,function*(){yield s.sendAsyncRequest({message:Object.assign(Object.assign({},e),{request:"configure"}),expectResponse:e=>{var t;return"event"==e.message.streaming&&"configured"==(null===(t=e.message.result)||void 0===t?void 0:t.event)}})})},switch(e){return r(this,void 0,void 0,function*(){yield s.sendAsyncRequest({message:{request:"switch",id:e},expectResponse:e=>{var t;return"event"==e.message.streaming&&"ok"==(null===(t=e.message.result)||void 0===t?void 0:t.switched)}}),t=e})},restart(){return r(this,arguments,void 0,function*(e=n){const r=yield s.sendAsyncRequest({message:Object.assign(Object.assign({},null==e?void 0:e.watchOptions),{request:"watch",id:t}),expectResponse:e=>{var t;return"event"==e.message.streaming&&"preparing"==(null===(t=e.message.result)||void 0===t?void 0:t.status)}});if(!r.jsep)throw new Error("Missing offer Jsep");yield d(s,r.jsep,null==e?void 0:e.mediaOptions),n=e})},unsubscribe(){return r(this,void 0,void 0,function*(){yield o.run()})}}}catch(e){throw yield o.run().catch(console.error),e}})}(o,e,t),attachToPlugin:e=>a(o,e),destroy(){return r(this,void 0,void 0,function*(){yield new Promise(function(e,t){o.destroy({success:e,error:t})})})}}})}function a(e,t){return r(this,void 0,void 0,function*(){const n=[],o=p(),i=yield new Promise(function(r,i){e.attach({plugin:t,success(e){r(e)},error:i,consentDialog(e){o.dispatchEvent(new CustomEvent("consentDialog",{detail:{state:e}}))},webrtcState(e){o.dispatchEvent(new CustomEvent("webrtcState",{detail:{state:e}}))},iceState(e){o.dispatchEvent(new CustomEvent("iceState",{detail:{state:e}}))},mediaState(e){o.dispatchEvent(new CustomEvent("mediaState",{detail:{state:e}}))},slowLink(e){o.dispatchEvent(new CustomEvent("slowLink",{detail:{state:e}}))},onmessage(e,t){const r={message:e,jsep:t},i=n.findIndex(e=>e.acceptResponse(r));-1!=i?n.splice(i,1):o.dispatchEvent(new CustomEvent("message",{detail:{message:e,jsep:t}}))},onlocaltrack(e,t){o.dispatchEvent(new CustomEvent("localtrack",{detail:{track:e,added:t}}))},onremotetrack(e,t,n){o.dispatchEvent(new CustomEvent("remotetrack",{detail:{track:e,mid:t,added:n}}))},ondataopen(e,t){o.dispatchEvent(new CustomEvent("dataopen",{detail:{label:e,protocol:t}}))},ondata(e,t){o.dispatchEvent(new CustomEvent("data",{detail:{data:e,label:t}}))},oncleanup(){o.dispatchEvent(new CustomEvent("cleanup"))},ondetached(){o.dispatchEvent(new CustomEvent("detached"))}})});i.eventTarget=o,i.sendRequest=function(e){return new Promise(function(t,n){i.send({message:e,success:t,error:n})})};let s=Promise.resolve();return i.sendAsyncRequest=function(e){const t=s.catch(function(){}).then(function(){return r(this,void 0,void 0,function*(){return yield new Promise(function(t,n){i.send({message:e.message,jsep:e.jsep,success:t,error:n})}),new Promise(function(t,r){n.push({acceptResponse(n){if("event"!=n.message.videoroom&&"event"!=n.message.streaming||!n.message.error_code)return!!e.expectResponse(n)&&(t(n),!0);{const e=new Error(n.message.error||n.message.error_code);return e.code=n.message.error_code,r(e),!0}}})})})});return s=t,t},i})}function c(e,t,n,o){return r(this,void 0,void 0,function*(){const i=Object.assign({},o),s=u(),c=l();try{const o=yield a(e,"janus.plugin.videoroom");s.add(function(){return r(this,void 0,void 0,function*(){yield new Promise(function(e,t){o.detach({success:e,error:t})})})}),o.eventTarget.addEventListener("remotetrack",function(e){e.detail.added?c.get("onTrackAdded").then(t=>t(e.detail.track,e.detail.mid)).catch(console.error):c.get("onTrackRemoved").then(t=>t(e.detail.track,e.detail.mid)).catch(console.error)});const u=yield o.sendAsyncRequest({message:{request:"join",ptype:"subscriber",room:t,streams:n},expectResponse:e=>"attached"==e.message.videoroom&&e.message.room==t});if(!u.jsep)throw new Error("Missing offer Jsep");return yield d(o,u.jsep,i.mediaOptions),{pluginHandle:o,onTrackAdded(e){c.set("onTrackAdded",e)},onTrackRemoved(e){c.set("onTrackRemoved",e)},addStreams(e){return r(this,void 0,void 0,function*(){const n=yield o.sendAsyncRequest({message:{request:"subscribe",streams:e},expectResponse:e=>"updated"==e.message.videoroom&&e.message.room==t});n.jsep&&(yield d(o,n.jsep,i.mediaOptions))})},removeStreams(e){return r(this,void 0,void 0,function*(){const n=yield o.sendAsyncRequest({message:{request:"unsubscribe",streams:e},expectResponse:e=>"updated"==e.message.videoroom&&e.message.room==t});n.jsep&&(yield d(o,n.jsep,i.mediaOptions))})},pause(){return r(this,void 0,void 0,function*(){yield o.sendAsyncRequest({message:{request:"pause"},expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.paused})})},resume(){return r(this,void 0,void 0,function*(){yield o.sendAsyncRequest({message:{request:"start"},expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.started})})},configure(e){return r(this,void 0,void 0,function*(){yield o.sendAsyncRequest({message:Object.assign(Object.assign({},e),{request:"configure",restart:!1}),expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.configured})})},restart(){return r(this,arguments,void 0,function*(e=i.mediaOptions){const t=yield o.sendAsyncRequest({message:{request:"configure",restart:!0},expectResponse:e=>"event"==e.message.videoroom&&"ok"==e.message.configured});if(!t.jsep)throw new Error("Missing offer Jsep");yield d(o,t.jsep,e),i.mediaOptions=e})},unsubscribe(){return r(this,void 0,void 0,function*(){yield s.run()})}}}catch(e){throw yield s.run().catch(console.error),e}})}function d(e,t,n){return r(this,void 0,void 0,function*(){(null==n?void 0:n.customizeRemoteSdp)&&n.customizeRemoteSdp(t);const r=yield new Promise(function(r,o){e.createAnswer(Object.assign(Object.assign({},n),{jsep:t,success:r,error:o}))});yield e.sendAsyncRequest({message:{request:"start"},jsep:r,expectResponse:e=>{var t;return"event"==e.message.videoroom&&"ok"==e.message.started||"event"==e.message.streaming&&"started"==(null===(t=e.message.result)||void 0===t?void 0:t.status)}})})}function u(){const e=[];return{add(t){e.push(t)},run(){let t=Promise.resolve();for(let n=e.length-1;n>=0;n--)t=t.then(e[n]);return t}}}function l(){const e={},t=t=>{if(!e[t]){let n=function(e){};const r=new Promise(e=>n=e);e[t]={promise:r,fulfill:n}}return e[t]};return{get:e=>t(e).promise,set(e,n){t(e).fulfill(n)}}}function p(){const e={};return{addEventListener(t,n){e[t]||(e[t]=[]),e[t].push(n)},removeEventListener(t,n){if(!e[t])return;const r=e[t].indexOf(n);r>=0&&e[t].splice(r,1)},dispatchEvent(t){if(e[t.type])for(let n=0;n<e[t.type].length;n++)e[t.type][n](t)}}}t.Janus=i.default},281(e,t,n){n.r(t),n.d(t,{default:()=>de});var r={};n.r(r),n.d(r,{fixNegotiationNeeded:()=>D,shimAddTrackRemoveTrack:()=>x,shimAddTrackRemoveTrackWithNative:()=>E,shimGetDisplayMedia:()=>S,shimGetSendersWithDtmf:()=>k,shimGetStats:()=>R,shimGetUserMedia:()=>C,shimMediaStream:()=>w,shimOnTrack:()=>T,shimPeerConnection:()=>O,shimSenderReceiverGetStats:()=>P});var o={};n.r(o),n.d(o,{shimAddTransceiver:()=>F,shimCreateAnswer:()=>J,shimCreateOffer:()=>U,shimGetDisplayMedia:()=>j,shimGetParameters:()=>G,shimGetUserMedia:()=>I,shimOnTrack:()=>_,shimPeerConnection:()=>A,shimRTCDataChannel:()=>V,shimReceiverGetStats:()=>L,shimRemoveStream:()=>N,shimSenderGetStats:()=>M});var i={};n.r(i),n.d(i,{shimAudioContext:()=>X,shimCallbacksAPI:()=>W,shimConstraints:()=>H,shimCreateOfferLegacy:()=>Y,shimGetUserMedia:()=>B,shimLocalStreamsAPI:()=>q,shimRTCIceServerUrls:()=>K,shimRemoteStreamsAPI:()=>z,shimTrackEventTransceiver:()=>Q});var s={};n.r(s),n.d(s,{removeExtmapAllowMixed:()=>ie,shimAddIceCandidateNullOrEmpty:()=>se,shimConnectionState:()=>oe,shimMaxMessageSize:()=>ne,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>ee,shimRTCIceCandidateRelayProtocol:()=>te,shimSendThrowTypeError:()=>re});let a=!0,c=!0;function d(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function u(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),o.apply(this,[e,i])};const i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function l(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function f(){if("object"==typeof window){if(a)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function h(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return h(e)?Object.keys(e).reduce(function(t,n){const r=h(e[n]),o=r?g(e[n]):e[n],i=r&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[n]:o})},{}):e}function v(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?v(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(t=>{v(e,e.get(t),n)})}))}function y(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const i=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&v(e,n,o)})}),o}const b=f;function C(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[o("min",n)]=r.ideal,t.optional.push(e),e={},e[o("max",n)]=r.ideal,t.optional.push(e)):(e[o("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const s=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let s=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>e.label.toLowerCase().includes(t)));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=i.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),b("chrome: "+JSON.stringify(e)),o(e)})}e.video=r(e.video)}return b("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){o(e,e=>{n.webkitGetUserMedia(e,t,e=>{r&&r(i(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return o(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Promise.reject(i(e))))}}}function S(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,o=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(n.video.mandatory.maxWidth=r),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function w(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function T(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const o=new Event("track");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],this.dispatchEvent(o)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[t.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else u(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function k(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let o=n.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function R(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},i=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(i(o(e)))};return t.apply(this,[r,e])}return new Promise((e,n)=>{t.apply(this,[function(t){e(i(o(t)))},n])}).then(n,r)}}function P(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>y(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),u(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>y(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function E(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),o.apply(this,arguments)}}function x(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return E(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(o.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=i(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>i(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]});const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],o=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function O(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})}function D(e,t){u(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}function I(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function j(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function _(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function A(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!o)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(o,i)}}function M(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function L(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),u(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function N(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){m("removeStream","removeTrack"),this.getSenders().forEach(t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)})})}function V(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function F(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function G(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function U(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function J(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function q(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach(e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{n.includes(e.track)&&this.removeTrack(e)})})}}function z(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function W(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o};let a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function B(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(H(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function H(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function K(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];void 0===r.urls&&r.url?(m("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Q(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function X(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Z=n(963),$=n.n(Z);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),r=$().parseCandidate(e.candidate);for(const e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,u(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function te(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||u(e,"icecandidate",e=>{if(e.candidate){const t=$().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function ne(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=$().splitSections(e.sdp);return t.shift(),t.some(e=>{const t=$().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const o=$().matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?r=parseInt(o[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],e);let o;o=0===n&&0===r?Number.POSITIVE_INFINITY:0===n||0===r?Math.max(n,r):Math.min(n,r);const i={};Object.defineProperty(i,"maxMessageSize",{get:()=>o}),this._sctp=i}return n.apply(this,arguments)}}function re(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],o=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},u(e,"datachannel",e=>(t(e.channel,e.target),e))}function oe(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function ie(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==e.trim()).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}const ce=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=f,a=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=d(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=d(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=d(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),c={browserDetails:a,commonShim:s,extractVersion:d,disableLog:l,disableWarnings:p,sdp:Z};switch(a.browser){case"chrome":if(!r||!O||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),c;if(null===a.version)return n("Chrome shim can not determine version, not shimming."),c;n("adapter.js shimming chrome."),c.browserShim=r,se(e,a),ae(e),C(e,a),w(e),O(e,a),T(e),x(e,a),k(e),R(e),P(e),D(e,a),ee(e),te(e),oe(e),ne(e,a),re(e),ie(e,a);break;case"firefox":if(!o||!A||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=o,se(e,a),ae(e),I(e,a),A(e,a),_(e),N(e),M(e),L(e),V(e),F(e),G(e),U(e),J(e),ee(e),oe(e),ne(e,a),re(e);break;case"safari":if(!i||!t.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=i,se(e,a),ae(e),K(e),Y(e),W(e),q(e),z(e),Q(e),B(e),X(e),ee(e),te(e),ne(e,a),re(e),ie(e,a);break;default:n("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),de=ce},963(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],o=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&o?{usernameFragment:r.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let o=3;o<r.length;o++){const i=r[o],s=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(s){const r=t.parseRtpMap(s),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=o.length?t.parseFmtp(o[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const o=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{o.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)});let o=0;return n.codecs.forEach(e=>{e.maxptime>o&&(o=e.maxptime)}),o>0&&(r+="a=maxptime:"+o+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{r+=t.writeExtmap(e)}),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),i=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),a=s.length>0&&s[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));d.length>0&&d[0].length>1&&d[0][0]===a&&(c=d[0][1]),r.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&a&&n.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=u})),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=0===o.length;const i=t.matchPrefix(e,"a=rtcp-mux");return n.mux=i.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const o=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let o;r.length>0&&(o=parseInt(r[0].substring(19),10)),isNaN(o)&&(o=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:n.fmt,maxMessageSize:o};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let o;const i=void 0!==n?n:2;return o=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+o+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(156)})());
//# sourceMappingURL=videoroom.js.map